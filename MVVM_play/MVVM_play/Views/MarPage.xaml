<Page
    x:Class="MVVM_play.Views.MarPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:MVVM_play.ViewModels"
    xmlns:converters="using:MVVM_play.Converters">

    <Page.DataContext>
        <vm:MarViewModel/>
    </Page.DataContext>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Patient Info -->
        <StackPanel Margin="10">
            <TextBlock Text="Patient Information" FontSize="18" FontWeight="Bold"/>
            <TextBlock Text="{Binding PatientName}" FontSize="16"/>
            <TextBlock Text="{Binding DateOfBirth, Converter={StaticResource DateTimeToStringConverter}}" FontSize="14"/>
            <TextBlock Text="{Binding RoomNumber}" FontSize="14"/>
            <TextBlock Text="{Binding Allergies}" FontSize="14" Foreground="Red"/>
        </StackPanel>

        <!-- Medications -->
        <ListView Grid.Row="1" ItemsSource="{Binding Medications}" SelectedItem="{Binding SelectedMedication, Mode=TwoWay}">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="vm:MedRecordViewModel">
                    <StackPanel Padding="10">
                        <TextBlock Text="{Binding MedicationName}" FontSize="16" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Dosage}" FontSize="14"/>
                        <TextBlock Text="{Binding Route}" FontSize="14"/>
                        <TextBlock Text="{Binding Frequency}" FontSize="14"/>
                        <TextBlock Text="{Binding Status}" FontSize="14" Foreground="DarkBlue"/>
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Administration Records -->
        <StackPanel Grid.Row="2" Margin="10">
            <TextBlock Text="Administration Records" FontSize="18" FontWeight="Bold"/>
            <ListView ItemsSource="{Binding SelectedMedication.AdminRecords}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="vm:AdminRecordViewModel">
                        <StackPanel Padding="10">
                            <TextBlock Text="{Binding AdministrationTime, Converter={StaticResource DateTimeToStringConverter}}" FontSize="14"/>
                            <TextBlock Text="{Binding AdministeredBy}" FontSize="14"/>
                            <TextBlock Text="{Binding Notes}" FontSize="14"/>
                            <TextBlock Text="{Binding WasAdministered, Converter={StaticResource BoolToYesNoConverter}}" FontSize="14" Foreground="Green"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <Button Content="Add Administration Record"
                    Command="{Binding AddAdminRecordCommand}"
                    Margin="10"
                    HorizontalAlignment="Center"
                    Padding="10,5"/>
        </StackPanel>
    </Grid>
</Page>